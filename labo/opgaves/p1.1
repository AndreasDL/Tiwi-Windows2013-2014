<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="generator" content="intranetr/0.10.0">
<title>Reeks 1 | iii intranet</title>    <link rel="stylesheet" type="text/css" media="screen,handheld" href="../../css/default.css?0.10.0">
    <link rel="stylesheet" type="text/css" media="print" href="../../css/print.css?0.10.0">
    <link rel="stylesheet" type="text/css" media="screen,handheld" href="../../css/sites/default.css">
    <script type="text/javascript" src="../../js/cache/0d6197553acf19ea859c96f7caf7d8fa6c6519b8.js?0.10.0"></script>
<!--[if lt IE 8]>
<link rel="stylesheet" type="text/css" href="/css/ie.css">
<![endif]-->
    <script type="text/javascript">
    (function() {
        var month = 8;
        iii.semester = month == 1 ? 1
            : month <= 6 ? 2
            : month <= 9 ? 0 : 1;
        if (iii.semester > 0) {
            var hideOtherSemester = function() {
                var other = iii.semester == 1 ? 2 : 1;
                $('#breadcrumbs li.group-sem'
                        + other
                        + ':not(.group-sem'
                        + iii.semester + '):not(.active)')
                    .hide();
            };
            $(document)
                .ready(hideOtherSemester)
                .on("contentUpdate.iii", hideOtherSemester);
        }
    })();
    </script>
</head>

<body>
    <div id="header"><h1>
    <a href="../../index.html" title="Naar de thuispagina">
        intranet
    </a>
</h1>
</div>
<div id="main">    <div id="node-children">
    <ul>
            <li><a href="index.html"><span style="float: right">&#8593;</span>Omhoog</a></li>
            </ul>
    </div>

<div id="content" class="">
        <div id="breadcrumbs-container">
    <span id="you-are-here">Je bent hier:</span>
    <ul id="breadcrumbs">
                            <li class="breadcrumb first"><a href="../../index.html" class="breadcrumb first">Intranet</a>
                </li>
                            <li class="breadcrumb"><a href="../index.html" class="breadcrumb">Windows</a>
                    <ul class="breadcrumb-siblings">
                                                <li class="separator"><span>Tweede bachelor</span></li>
                                                                                                                                                                                                                <li class="breadcrumb-sibling group-sem2"><a class="breadcrumb-sibling group-sem2" href="../../Besturingssystemen-I/index.html">Besturingssystemen I</a></li>
                                                                                                                                                                                                                <li class="breadcrumb-sibling group-sem1 leaf"><a class="breadcrumb-sibling group-sem1 leaf" href="../../Computernetwerken-I/index.html">Computernetwerken I</a></li>
                                                                                                                                                                                                                <li class="breadcrumb-sibling group-sem1"><a class="breadcrumb-sibling group-sem1" href="../../Informatica-II/index.html">Informatica II</a></li>
                                                                                                                                                                                                                <li class="breadcrumb-sibling group-sem2"><a class="breadcrumb-sibling group-sem2" href="../../Softwareontwikkeling-I/index.html">Softwareontwikkeling 1</a></li>
                                                                <li class="separator"><span>Derde bachelor</span></li>
                                                                                                                                                                                                                <li class="breadcrumb-sibling group-sem2"><a class="breadcrumb-sibling group-sem2" href="../../Algoritmen-I/index.html">Algoritmen I</a></li>
                                                                                                                                                                                                                <li class="breadcrumb-sibling group-sem2 leaf"><a class="breadcrumb-sibling group-sem2 leaf" href="../../Computergrafiek/index.html">Computergrafiek</a></li>
                                                                                                                                                                                                                <li class="breadcrumb-sibling group-sem1"><a class="breadcrumb-sibling group-sem1" href="../../Computernetwerken-II/index.html">Computernetwerken II</a></li>
                                                                                                                                                                                                                <li class="breadcrumb-sibling group-sem2"><a class="breadcrumb-sibling group-sem2" href="../../Computernetwerken-III/index.html">Computernetwerken III</a></li>
                                                                                                                                                                                                                <li class="breadcrumb-sibling group-sem1"><a class="breadcrumb-sibling group-sem1" href="../../Databanken/index.html">Databanken</a></li>
                                                                                                                                                                                                                <li class="breadcrumb-sibling group-sem1"><a class="breadcrumb-sibling group-sem1" href="../../Design-Patterns/index.html">Design Patterns</a></li>
                                                                                                                                                                                                                                                            <li class="breadcrumb-sibling group-sem1 group-sem2"><a class="breadcrumb-sibling group-sem1 group-sem2" href="../../Hardware/index.html">Hardware</a></li>
                                                                                                                                                                                                                <li class="breadcrumb-sibling group-sem2"><a class="breadcrumb-sibling group-sem2" href="../../OGP/index.html">OGP</a></li>
                                                                                                                                                                                                                <li class="breadcrumb-sibling group-sem1 leaf"><a class="breadcrumb-sibling group-sem1 leaf" href="../../Systeemanalyse-I/index.html">Systeemanalyse I</a></li>
                                                                                                                                                                                                                <li class="breadcrumb-sibling group-sem1"><a class="breadcrumb-sibling group-sem1" href="../../UNIX/index.html">UNIX</a></li>
                                                                                                                                                                                                                <li class="breadcrumb-sibling group-sem1"><a class="breadcrumb-sibling group-sem1" href="../../Beveiliging/index.html">Beveiliging</a></li>
                                                                                                                                                                                                                <li class="breadcrumb-sibling group-sem1"><a class="breadcrumb-sibling group-sem1" href="../../Computernetwerken-IV/index.html">Computernetwerken IV</a></li>
                                                                                                                                                                                                                                                            <li class="breadcrumb-sibling group-sem1 group-sem2 leaf"><a class="breadcrumb-sibling group-sem1 group-sem2 leaf" href="../../Masterproef/index.html">Masterproef</a></li>
                                                                                                                                                                                                                <li class="breadcrumb-sibling group-sem1 leaf"><a class="breadcrumb-sibling group-sem1 leaf" href="../../Systeemanalyse-II/index.html">Systeemanalyse II</a></li>
                                                                                                                                                                                                                <li class="breadcrumb-sibling group-sem1 active"><a class="breadcrumb-sibling group-sem1 active" href="../index.html">Windows</a></li>
                                                                <li class="separator"><span>Algemeen</span></li>
                                                                                                                                                                    <li class="breadcrumb-sibling leaf"><a class="breadcrumb-sibling leaf" href="../../Activiteiten/index.html">Activiteiten</a></li>
                                                                                                                                                                    <li class="breadcrumb-sibling leaf"><a class="breadcrumb-sibling leaf" href="../../Huisregels-labos/index.html">Huisregels voor labo&#039;s</a></li>
                                                                                                                                                                    <li class="breadcrumb-sibling leaf"><a class="breadcrumb-sibling leaf" href="../../Opleiding-Informatica/index.html">Opleiding Informatica GTI</a></li>
                                                                                                                                                                    <li class="breadcrumb-sibling leaf"><a class="breadcrumb-sibling leaf" href="../../Andere-problemen/index.html">Probleemoplossende instanties</a></li>
                                                                                                                                                                    <li class="breadcrumb-sibling"><a class="breadcrumb-sibling" href="../../Roosters/index.html">Roosters</a></li>
                                        </ul>
                </li>
                            <li class="breadcrumb"><a href="index.html" class="breadcrumb">Labo</a>
                    <ul class="breadcrumb-siblings">
                                                                                                                                                    <li class="breadcrumb-sibling active"><a class="breadcrumb-sibling active" href="index.html">Labo</a></li>
                                                                                                                                                                    <li class="breadcrumb-sibling leaf"><a class="breadcrumb-sibling leaf" href="../Theorie/index.html">Theorie</a></li>
                                        </ul>
                </li>
                            <li class="breadcrumb"><a href="p1.1" class="breadcrumb">Reeks 1</a>
                    <ul class="breadcrumb-siblings">
                                                                                                                                                    <li class="breadcrumb-sibling leaf"><a class="breadcrumb-sibling leaf" href="p0.1">Reeks 0</a></li>
                                                                                                                                                                    <li class="breadcrumb-sibling leaf active current"><a class="breadcrumb-sibling leaf active current" href="p1.1">Reeks 1</a></li>
                                                                                                                                                                    <li class="breadcrumb-sibling leaf"><a class="breadcrumb-sibling leaf" href="p2.1">Reeks 2</a></li>
                                                                                                                                                                    <li class="breadcrumb-sibling leaf"><a class="breadcrumb-sibling leaf" href="p3.1">Reeks 3</a></li>
                                                                                                                                                                    <li class="breadcrumb-sibling leaf"><a class="breadcrumb-sibling leaf" href="p4.1">Reeks 4</a></li>
                                                                                                                                                                    <li class="breadcrumb-sibling leaf"><a class="breadcrumb-sibling leaf" href="p5.1">Reeks 5</a></li>
                                                                                                                                                                    <li class="breadcrumb-sibling leaf"><a class="breadcrumb-sibling leaf" href="p6.1">Reeks 6</a></li>
                                                                                                                                                                    <li class="breadcrumb-sibling leaf"><a class="breadcrumb-sibling leaf" href="p7.1">Reeks 7</a></li>
                                                                                                                                                                    <li class="breadcrumb-sibling leaf"><a class="breadcrumb-sibling leaf" href="p8.1">Reeks 8</a></li>
                                        </ul>
                </li>
        </ul>
    </div>
    <h2>Reeks 1</h2>
    <div id="page-content">
        <h3>COM programmatie in de praktijk</h3>
<h5>Thuis:</h5>
<ol>
<li><a href=
"http://www.microsoft.com/downloads/details.aspx?FamilyID=9d467a69-57ff-4ae7-96ee-b18c4790cffd&amp;DisplayLang=en">
Oleview</a>&nbsp; installeren.</li>
<li><strong>Perl:</strong> Download <a href=
"p1/ActivePerl-5.16.3.1603-MSWin32-x86-296746.msi">perl (Windows
versie)</a> - inclusief perlscript en <strong>ActivePerl
documentatie</strong>. </li>
<li>De <strong>MSDN Library</strong> van VisualStudio 2008 :
beschikbaar op <a href=
"http://www.microsoft.com/downloads/en/details.aspx?FamilyID=7bbe5eda-5062-4ebb-83c7-d3c5ff92a373&amp;displaylang=en">
WWW</a> of CD - deze versie verschilt minimaal van de MSDN Library
op de labotoestellen.<br>
Druk <a href="references.html">dit overzicht</a> af, dan vind je
sneller informatie in de <strong>MSDN Library</strong>.</li>
</ol>
De <strong>ActivePerl documentatie</strong> en <strong>MSDN
Library</strong> zijn lokaal beschikbaar op de labocomputers en kan
je raadplegen tijdens de testen. Je kan er veel informatie
terugvinden en kopiëren. Je mag ook de cursus Perl van vorig jaar
gebruiken op de testen.
<h4>COM programmatie in de praktijk</h4>
We bespreken in deze reeks de basisprincipes van COM programmatie
met scripts.
<p>Een <em>Windows script</em> is een tekstfile, geschreven in een
scripttaal (<em>Script Engine</em>). Een Windows script wordt niet
gecompileerd in .exe vorm, maar is volledig aangewezen op een
<em>Scripting Host</em> om zijn code <em>at runtime</em> uit te
voeren.<br>
Elke scripting host biedt een omgeving aan die zorgt voor de
correcte uitvoering van elk script, geschreven in een taal waarvoor
de ActiveX script engine geïnstalleerd is. De meeste scripting
hosts zijn toepassingen (zoals Internet Explorer zie
hoofdstuk&nbsp;5). </p>
<p>De volgende <em>Scripting Hosts</em>, die vanuit een
<strong>Command Prompt</strong> console worden opgestart, zijn
uitermate geschikt voor operating systeem verwante taken:</p>
<ul>
<li><strong>WSH</strong>: <strong>W</strong>indow
<strong>S</strong>cripting <strong>H</strong>ost &nbsp;,
gecombineerd met <em>VBScript</em>, <em>JavaScript</em> of
<em>Perlscript</em> als <em>scripting Engine</em>.</li>
<li><strong>Perl</strong>: enkel in combinatie met engine
<em>PerlScript</em></li>
</ul>
In deze labo's beperken we ons tot het gebruik van
<strong>Perl</strong> als <em>scripting Host</em>.
<h5>Scripting engines : VBScript / PerlScript</h5>
De meeste voorbeelden in de <strong>MSDN Library</strong> zijn
geschreven in <em>VBScript</em>. Deze voorbeelden kan je NIET
uittesten met perl als host. We geven toch een korte vergelijking
tussen <em>VBScript</em> en <em>PerlScript</em>, zodat je de
voorbeelden kan omzetten naar <em>Perlscript</em>
<p>Hieronder een kort overzicht met belangrijke verschillen:</p>
<table border="1" align="center">
<tr>
<th>&nbsp;</th>
<th><em>VBScript</em></th>
<th><em>PerlScript</em></th>
</tr>
<tr>
<td>Case-sensitive ?</td>
<td><strong>nee</strong></td>
<td><strong>ja</strong></td>
</tr>
<tr>
<td>Commentaar toevoegen :</td>
<td>' comment</td>
<td># comment</td>
</tr>
<tr>
<td>Afsluiten van een statement :</td>
<td>nieuwe regel nemen</td>
<td><strong>;</strong> toevoegen</td>
</tr>
<tr>
<td>Declaratie verplicht maken :</td>
<td><strong>Option Explicit</strong></td>
<td><strong>use strict;</strong></td>
</tr>
<tr>
<td>Variabele declareren :<br>
Kan ook lokaal in functie/procedure</td>
<td><strong>Dim</strong> <em>varnaam</em></td>
<td><strong>my</strong> <em>$varnaam</em>;<br>
<strong>our</strong> <em>$varnaam</em>;</td>
</tr>
<tr>
<td>Com-object toekennen :</td>
<td><strong>Set</strong> <em>varnaam</em> <strong>=</strong></td>
<td><strong>$</strong><em>varnaam</em><strong>=</strong></td>
</tr>
<tr>
<td>Attribuut opvragen van een object :</td>
<td><em>varnaam</em> <strong>.</strong> <em>attribuutnaam</em></td>
<td>
$<em>varnaam</em><strong>-&gt;{</strong><em>attribuutnaam</em><strong>}</strong></td>
</tr>
<tr>
<td>Methode uitvoeren voor een object :</td>
<td><em>varnaam</em> <strong>.</strong>
<em>methodenaam(argumenten)</em></td>
<td>
$<em>varnaam</em><strong>-&gt;</strong><em>methodenaam(argumenten)</em></td>
</tr>
</table>
<p><strong>Merk op:</strong></p>
<ul>
<li>In een scripttaal heeft een <strong>variabele</strong> geen
specifiek type en moet dus niet gedeclareerd worden. Het grote
nadeel hiervan is dat domme typfouten in een variabelenaam niet
gemakkelijk opgespoord worden. Je kan declaratie toch verplicht
maken.</li>
<li>In <strong>VBScript</strong> moet je de <strong>Set</strong>
instructie gebruiken om een COM-object toe te kennen aan een
variabele, in <strong>PerlScript</strong> is dit een gewone
toekenning.</li>
<li>In <strong>PerlScript</strong> wordt een <em>referentie naar
het object</em> opgeslaan in de variabele, waardoor de attributen
en methodes met <strong>-&gt;</strong> worden opgevraagd en dus
niet met de punt-notatie.</li>
</ul>
Uiteraard heeft elke taal zijn eigen functies, statements en
bijzonderheden, waarvoor je best de documentatie raadpleegt. In
<a href="perl_herhaling.html">herhaling Perl</a> vind je een
kort overzicht van wat je vorig jaar geleerd hebt. Breng de cursus
Perl van vorig jaar mee en raadpleeg ook de <em>ActivePerl User
Guide</em> die op de Desktop gerefereerd wordt.
<h5>Perl als Scripting Host</h5>
Documentatie over Perl (en PerlScript) vind je in de
<strong>ActivePerl documentatie</strong>, standaard geïnstalleerd
op de labo-toestellen.
<dl class="compact">
<dt>1.</dt>
<dd>Een scriptfile met extensie <strong>.pl</strong> kan je direct
uitvoeren aan de <strong>Command Prompt</strong> in een console. Je
kan dan ook eenvoudig argumenten meegeven aan een
<em>perlscript</em>. Gebruik <strong>@ARGV</strong> om de
argumenten te overlopen.<br>
Hoe kan je een tekst die bestaat uit meerdere woorden als 1
argument doorgeven?
<p><a class="popout" href="p1/01.pl">antwoord</a></p>
</dd>
</dl>
Ook in <em>Emacs</em> kan je een perlscript direct uitvoeren (met
<strong>Perl</strong> als host) - argumenten doorgeven kan
niet.<br>
Heel handig zijn volgende toetsencombinaties, beschikbaar indien je
het <em>.emacs</em> configuratiebestand van de labocomputers
gebruikt:
<table align="center" border="1">
<tr>
<th>F8</th>
<td>markeer alle tekst</td>
</tr>
<tr>
<th>F5<br>
of<br>
Ctrl-Alt-p</th>
<td>evalueer de gemarkeerde tekst als perl-programma</td>
</tr>
<tr>
<th>Ctrl-F5</th>
<td>laat de <strong>perl-tidy</strong> <em>beautifier</em> de
gemarkeerde tekst herformatteren</td>
</tr>
</table>
<h5>Modules gebruiken in PerlScript</h5>
Perl(Script) stelt een enorme hoeveelheid extra functionaliteit ter
beschikking met behulp van <strong>modules</strong>. Je kan een
overzicht raadplegen en ook PerlScript modules downloaden op
<a href="http://www.cpan.org/">CPAN</a>, of met de
<strong>ppm</strong> opdracht.
<dl class="compact">
<dt>2.</dt>
<dd>Informatie over de ingeladen modules vind je in de hash
<strong>%INC</strong>, zoals in onderstaand voorbeeld wordt
geïllustreerd. Je krijgt hierdoor toegang tot de
<em>geëxporteerde</em> functies uit de module.<br>
In de inleiding werd de module <strong>strict</strong> reeds
vermeld. Als je deze module inlaadt worden declaraties verplicht
gemaakt. Welke submodules worden hierdoor ingeladen? (Je moet nu
wel alle variabelen ook declareren.)<br>
Indien je snel over de huidige directory wilt beschikken gebruik je
in Perl(Script):
<pre>
    use Cwd;
    print "\nCurrent dir : ",getcwd();
</pre>
Door het inladen van de module <strong>Cwd</strong> worden nog
andere modules automatisch ingeladen. Welke?
<p><a class="popout" href="p1/02.pl">voorbeeld</a></p>
</dd>
</dl>
Met <strong>Perl</strong> als host kan je <strong>niet
automatisch</strong> COM-objecten initialiseren. In de
<strong>Perl-documentatie</strong>, de sectie <em>Using OLE with
Perl</em>, staat beschreven dat je hiervoor de OLE-module inlaadt
met:
<pre>
    use Win32::OLE qw(in with);
</pre>
Onderzoek welke sub-modules nu worden ingeladen.<br>
Deze module bevat een aantal interessante/noodzakelijke functies en
methodes om COM objecten te initialiseren en te gebruiken vanuit
<em>Perlscript</em>. De beschrijving van alle beschikbare functies
en methodes zoek je op in dezelfde
<strong>Perl-documentatie</strong> in de sectie <em>Win32</em> /
<em>OLE</em> (in de linkerkolom bijna helemaal naar beneden
scrollen).<br>
Een korte bespreking van de interessantste functies:
<dl class="compact">
<dt>3.</dt>
<dd><em>Initialiseren van COM-objecten met het ProgID</em><br>
De VBScript-engine beschikt over de functie
<strong>Createobject(ProgID)</strong> waarmee je een COM-object kan
initialiseren.
<pre>
    set cdo = CreateObject("CDO.Message")
</pre>
<p>In PerlScript gebruik je hiervoor de functie
<strong>new(<em>ProgID</em>)</strong> van de <strong>Win32::OLE
module</strong>.</p>
<p><a class="popout" href="p1/03.pl">voorbeeld</a></p>
</dd>
<dt>4.</dt>
<dd>Met <strong>QueryObjectType</strong> bekom je extra informatie
over het type van een COM object. Vergelijk dit met de informatie
die je met ref kon opvragen.
<p><a class="popout" href="p1/04.pl">voorbeeld</a></p>
</dd>
<dt>5.</dt>
<dd>Met <strong>EnumAllObjects</strong> kan je een lijst maken van
alle OLE-objecten die geladen zijn. Dit kan handig zijn bij
debuggen.
<p><a class="popout" href="p1/05.pl">voorbeeld</a></p>
</dd>
<dt>6.</dt>
<dd>Indien een fout optreedt zal het perlScript niet stoppen. Je
kan echter met behulp van <strong>LastError()</strong> de
foutmelding opvragen. Probeer dit zelf uit door een fout
<em>ProgId</em> in te geven.<br>
De foutmelding die je krijgt is afhankelijk van de Script Host.
<p><a class="popout" href="p1/06.pl">antwoord</a></p>
</dd>
<dt>7.</dt>
<dd>Een interessante mogelijkheid is de <em>class variabele</em>
<strong>Warn</strong> instellen op <strong>3</strong>. Hierdoor zal
bij elke fout het script wel stoppen en ook de foutmelding
uitschrijven, zonder dat je dit zelf expliciet vraagt. In de
<strong>Perl documentatie</strong> vind je informatie over deze
variabele en de betekenis van de waarden bij <em>WIN32 / OLE</em>.
<p><a class="popout" href="p1/07.pl">voorbeeld</a></p>
</dd>
</dl>
<h4>Type Library gebruiken</h4>
Geïnterpreteerde omgevingen (zoals scripts) kunnen een beroep doen
op <em>type libraries</em>, maar enkel om gebruik te maken van de
erin gedefiniëerde symbolische constanten. In de documentatie
worden constanten regelmatig gebruikt, maar het is niet altijd
duidelijk wat hun waarde is. In plaats van de waarden op te zoeken
in de documentatie of in de bijhorende <strong>Type
Library</strong> (met <em>Oleview</em>) is het handiger om de
bibliotheek zelf in te laden.
<p>Gebruik hiervoor de module <strong>Win32::OLE::Const
<em>Naam_bibliotheek</em></strong>. In de <strong>Perl
documentatie</strong> vind je uitgebreide informatie over de
mogelijkheden van deze module.<br>
Het argument <em>Naam-bibliotheek</em> wordt geïnterpreteerd als
<em>reguliere expressie</em>. Enkel indien een "unieke" typelibrary
aan de naamgeving voldoet zal ze ook worden ingeladen. Om het
opzoeken van de bibliotheek in het register te versnellen wordt
deze reguliere expressie best vooraan impliciet uitgebreid met
<strong>^</strong>. Voeg daarom ook een <strong>.*</strong> toe
indien de naam van de typelibrary niet begint met het opgegeven
argument. Er treedt geen fout op indien er geen enkele bibliotheek
aan de reguliere expressie voldoet !!.</p>
<dl class="compact">
<dt>8.</dt>
<dd>In de vorige reeks heb je de type libraries moeten opzoeken die
horen bij de COM-klassen <strong>Excel.Sheet</strong> en
<strong>CDO.Message</strong>. Laad nu beide libraries in, en
schrijf een willekeurig gekozen constante uit (zoek de naam van een
constante op met Oleview). Experimenteer met de reguliere expressie
en kijk wat er gebeurt indien de bibliotheeknaam niet uniek is, of
indien je een foute naam opgeeft.
<p><a class="popout" href="p1/08.pl">antwoord</a></p>
</dd>
<dt>9.</dt>
<dd>In de module <strong>Win32::OLE::Const</strong> beschik je over
de interessante methode <strong>Load</strong> waarmee
<strong>alle</strong> constanten van een typelibrary in (een
referentie naar) een hash worden inladen. Toon alle constanten van
een bibliotheek, waarvan je de naam als argument meegeeft met je
script.<br>
Nu kan je snel achterhalen welke constanten in die bibliotheek
zitten.
<p><a class="popout" href="p1/09.pl">antwoord</a></p>
</dd>
<dt>10.</dt>
<dd>De <strong>Load</strong> methode kan ook een <strong>OLE
object</strong> als argument hebben. In Perl(Script) beschik je dus
heel eenvoudig over alle constanten van een typelibrary die hoort
bij een specifiek COM-object. Gebruik deze methode om een overzicht
te tonen van alle constanten van een COM-object. Orden nu ook dit
overzicht op de constantennaam.
<p><a class="popout" href="p1/10.pl">antwoord</a></p>
</dd>
</dl>
<h4>Collaboration Data Objects (CDO) : mail versturen</h4>
<dl class="compact">
<dt>11.</dt>
<dd>Er zijn heel veel manieren om een mail te versturen, zonder een
expliciete mail-client te gebruiken. In <strong>perl</strong> kan
je hiervoor gebruik maken van de module <em>NET::SMTP</em>, zie
voorbeeld. Deze werkwijze kan echter niet gebruikt worden in een
andere "omgeving". 
<p><a class="popout" href="p1/11.pl">voorbeeld</a></p>
</dd>
</dl>
In deze paragraaf versturen we de mail door enkel gebruik te maken
van COM-objecten. We gebruiken nog steeds perl als "host", en
perlScript als "scripttaal", maar ook met een andere host of engine
blijft deze oplossing correct werken. We beperken ons tot het
versturen van een eenvoudige tekstboodschap naar één mail-adres,
met behulp van het SMTP-protocol.
<p>De <strong>hoofdbedoeling</strong> van deze oefening is dat je
leert werken met COM-objecten, leert opzoeken in de documentatie en
de mogelijkheden van de module Win32::OLE begrijpt.</p>
<p>Alle noodzakelijke informatie over de COM-objecten die we
hiervoor nodig hebben, vind je in de <strong>MSDN Library</strong>
terug in de tak <em>WIN32 and COM Development / Messaging and
Collaboration / Collaboration Data Objects (CDO) / CDO for Windows
2000</em>.<br>
De subtak <em>About CDO for Windows 2000 / CDO for Windows 2000
Object Model</em> toont de volledige hiërarchie.<br>
De verdere beschrijving van alle klassen vind je terug in de subtak
<em>Reference / COM Classes</em> . Voor onze eenvoudige mail
gebruik je twee COM-klassen :</p>
<table border="1" width="60%" align="center">
<tr>
<th>COM klasse</th>
<th>ProgId</th>
</tr>
<tr>
<td>Message</td>
<td>CDO.Message</td>
</tr>
<tr>
<td>Configuration</td>
<td>CDO.Configuration</td>
</tr>
</table>
<p>Voor de "Message" klasse beperken we ons tot de interface
<em>IMessage</em>. De beschikbare <em>attributen/methodes</em> kan
je ook direct terugvinden in de tak <em>Reference /
Interfaces</em>.</p>
<dl class="compact">
<dt>12.</dt>
<dd>Een <strong>eerste stap</strong> is het initialiseren van een
mail-object met een Message Object - zie hiervoor. Vul gegevens in
voor de afzender, de bestemmeling, het onderwerp en de inhoud. Zoek
de juiste attribuutnamen op in de interface <em>IMessage</em>. In
<strong>PerlScript</strong> bevat de variabele een referentie naar
het Message Object, en moet je
<strong>-&gt;{<em>attributeName</em>}</strong> gebruiken.
<p><a class="popout" href="p1/12.pl">antwoord</a></p>
</dd>
</dl>
De methode <strong>Send()</strong> uit de interface
<em>IMessage</em> is verantwoordelijk voor het verzenden van de
mail. Als je dit uitprobeert, dan zal de mail waarschijnlijk niet
toekomen: je hebt immers niet opgegeven <em>hoe</em> dit moet
gebeuren. (Indien <strong>Outlook Express</strong> correct
geconfigureerd is via smtp, kan dit wel werken.)<br>
De "Configuration" klasse is verantwoordelijk voor de instellingen.
Voor deze klasse bestaat enkel de interface
<em>IConfiguration</em>, met als enige <em>attribuut</em> de
<strong>Fields</strong> collectie, die de "configuration settings"
instelt. We bespreken eerst algemeen wat collecties zijn.
<h5>Collections</h5>
Een COM-hiërarchie bevat dikwijls <strong>Collection</strong>
objects. Dit is een verzameling van objecten die individueel kunnen
aangesproken worden vanuit de collectie. Meestal is de naam van een
collectie object een meervoud (bijvoorbeeld <em>Fields</em>).
Gebruik voor de variabelen die refereren naar collecties ook altijd
een naam in het meervoud, om duidelijk te maken dat deze objecten
diverse data elementen bevatten. De meeste collecties hebben een
<strong>Count</strong> attribuut, dat weergeeft hoeveel objecten de
collectie bevat. Individuele elementen van een collectie worden
meestal aangesproken met behulp van de
<strong>Item(<em>index</em>)</strong> methode. Doorgaans is deze
methode de default methode van het object, waardoor men de
<strong>-&gt;Item</strong> notatie kan weglaten, en men de indruk
krijgt dat <em>index</em> een attribuut zou zijn. Hierdoor wordt de
syntax om individuele elementen van collections aan te spreken
identiek aan die om hashelementen aan te spreken.
<p>De indexering van collections moet niet altijd numeriek. Soms
kan je voor dezelfde collectie, zowel numeriek als met een string
indexeren. De methode van indexering wordt bepaald door de klasse
van het object. Om onafhankelijk te zijn van de specifieke
indexering, worden collections dikwijls afgelopen met behulp van de
<nobr><strong>foreach ... (in ...)</strong></nobr> instructie in
PerlScript. Daarbij gebruik je de functie <strong>in</strong>, die
door de module <strong>Win32::OLE</strong> wordt geïmplementeerd,
om <em>collections</em> om te vormen in arrays van individuele
objecten. Vergeet niet om deze functie expliciet te vermelden bij
het inladen van de module.</p>
<dl class="compact">
<dt>13.</dt>
<dd>Je kan het <strong>Configuration</strong> object initialiseren
als onafhankelijk object, met zijn eigen <em>ProgId</em>, maar je
kan dit object ook ophalen met het <strong>Configuration</strong> -
<em>attribuut</em> van een "Message" object.<br>
Initialiseer het <strong>Configuration</strong> object en bepaal
het objecttype van de objecten uit de <strong>Fields</strong>
collectie. Bepaal ook het aantal objecten in deze collectie.
<p><a class="popout" href="p1/13.pl">antwoord</a></p>
</dd>
<dt>14.</dt>
<dd>Elk element uit de <strong>Fields</strong> collectie is zelf
een <strong>Field</strong> object. Een <strong>Field</strong>
object is eigenlijk een basisobject, dat ook in andere COM-modellen
terugkomt. In de tak <em>WIN32 and COM Development / Messaging and
Collaboration / CDO 1.2.1 / CDO Library / CDO Reference</em> vind
je een uitgebreide beschrijving van o.a. dit <strong>Field</strong>
object en bijhorende attributen en methoden. De belangrijkste
attributen van dit <strong>Field</strong> object zijn :
<strong>name, value</strong>. Geef een overzicht van de velden die
standaard ingesteld zijn voor een configuration object. Bevat dit
de waarden (values) die je had verwacht ?
<p><a class="popout" href="p1/14.pl">antwoord</a></p>
</dd>
</dl>
Waarschijnlijk bevat dit configuratie object geen informatie over
de uitgaande server. In de paragraaf <em>CDO for Windows 2000 /
Messaging / Messaging Programming Tasks / Configuring the Message
Object / Sending or Posting Using the Network</em> wordt beschreven
welke instellingen noodzakelijk zijn om een mail te versturen over
het netwerk met het SMTP-protocol : <strong>sendusing</strong> en
<strong>smtpserver</strong>. Bekijk ook het voorbeeldje onderaan
(in VbScript).<br>
Omdat het <strong>Configuration</strong> object zijn informatie
haalt bij het mail-programma <strong>Outlook Express</strong>, kan
je de instellingen gewoon instellen door dit programma te
initialiseren met een juiste account. Het belangrijkste is het
instellen van de uitgaande server.<br>
Dit kan je thuis gemakkelijk uitproberen. Nu bevat het configuratie
object veel meer velden, en zal het verzenden van de mail wel
lukken.
<h5>Hoe stel je zelf de configuratie in?</h5>
Voeg de volgende initialisaties toe:
<pre>
   $conf-&gt;Fields("http://schemas.microsoft.com/cdo/configuration/smtpserver")-&gt;{Value}     = "smtp.hogent.be"; #thuis aanpassen
   $conf-&gt;Fields("http://schemas.microsoft.com/cdo/configuration/smtpserverport")-&gt;{Value} = 25;               #niet noodzakelijk
   $conf-&gt;Fields("http://schemas.microsoft.com/cdo/configuration/sendusing")-&gt;{Value}      = 2;
   $conf-&gt;{Fields}-&gt;Update();      #is noodzakelijk
</pre>
Tot slot moet je deze configuratie instellen op het Message Object
:
<pre>
      $mail-&gt;{Configuration}=$conf;  #moet ingevuld worden
</pre>
Nu zal het verzenden van de mail met <strong>send()</strong> altijd
lukken, ook als <strong>Outlook Express</strong> niet is ingesteld.
<dl class="compact">
<dt>15.</dt>
<dd>Je kan zelf een aantal andere mogelijkheden uitproberen, zoals
een attachment toevoegen. Zoek de nodige attributen en methodes op
in de documentatie.
<p><a class="popout" href="p1/15.pl">antwoord</a></p>
</dd>
</dl>
<h5>Mag het iets meer zijn ?</h5>
In deze laatste sectie leggen we uit hoe je meer informatie kan
vinden in de <strong>Type Library</strong> om beter te begrijpen
wat hiervoor is gebeurd.<br>
De namen van de velden die je moest instellen zijn eerder complex.
<dl class="compact">
<dt>16.</dt>
<dd>Pas oefening 10 aan zodat alle constanten getoond worden van de
type library die hoort bij de <em>configuration class</em>. Vind je
bovenstaande namen terug?.
<p>Toon nu enkel de constanten uit de type library waarvoor de
<code>$key</code> iets te maken heeft met
<strong>sendusing</strong> of <strong>smtpserver</strong>. Je toont
dus enkel die constanten waarvoor de naam een deelstring
<strong>SendUsing</strong> of <strong>SMTPServer</strong> bevat. Je
vindt de constanten <strong>cdoSMTPServer &nbsp; cdoSendUsingPort
&nbsp; cdoSendUsingMethod</strong> die je nodig hebt voor de
configuratie. De inhoud van deze constanten bevat de namen van de
velden die je moest initialiseren in het <em>Configuration</em>
object.</p>
<p><a class="popout" href="p1/16.pl">antwoord</a></p>
</dd>
<dt>17.</dt>
<dd>Om het configuratie-object correct in te vullen, moet je enkel
nog de identificatie van de smtp-server kennen (voor de Hogeschool
is dit <strong>smtp.hogent.be</strong>).<br>
Onderstaand voorbeeld gebruikt de constanten uit de type library om
het configuration object juist in te stellen. Merk op dat je de
namespace
<code>"http://schemas.microsoft.com/cdo/configuration"</code> niet
meer hard-codeert.
<p><a class="popout" href="p1/17.pl">voorbeeld</a></p>
</dd>
<dt>18.</dt>
<dd>Na een <em>update</em> van het configuratie-object, kan je voor
het <strong>Message</strong> object de referentie naar dit
configuratie-object instellen. Met <strong>send()</strong> wordt de
mail nu effectief verstuurd.
<p><a class="popout" href="p1/18.pl">antwoord</a></p>
</dd>
</dl>

        <div id="page-content-end"></div>
    </div>
    <div id="footer">    <div id="metadata">
    Laatst gewijzigd
            op
        22-10-2013
        om
        11:26
        
                door
                    <a href="mailto:Marleen.Denert@UGent.be">Marleen Denert</a>
                
        
    </div>
<div id="tag">intranetr/0.10.0</div>
<div id="footer-end"></div>
</div>
</div>
</div>
</body>

</html>

<!-- 103 ms / 603 KB -->
